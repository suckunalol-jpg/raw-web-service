<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ScriptHost</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #0f0f13;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      padding: 30px 20px;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      color: #a78bfa;
      margin-bottom: 6px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      font-size: 0.85rem;
      margin-bottom: 30px;
    }
    .container { max-width: 860px; margin: 0 auto; }

    .card {
      background: #1a1a24;
      border: 1px solid #2a2a3a;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .card h2 {
      font-size: 1rem;
      color: #a78bfa;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    label { display: block; font-size: 0.82rem; color: #888; margin-bottom: 5px; }
    input[type="text"], input[type="password"], textarea {
      width: 100%;
      background: #0f0f13;
      border: 1px solid #2a2a3a;
      border-radius: 8px;
      color: #e0e0e0;
      padding: 10px 12px;
      font-size: 0.9rem;
      margin-bottom: 14px;
      outline: none;
      transition: border-color 0.2s;
    }
    input:focus, textarea:focus { border-color: #a78bfa; }
    textarea { font-family: 'Courier New', monospace; resize: vertical; min-height: 160px; }

    button {
      background: #7c3aed;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 22px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }
    button:hover { background: #6d28d9; }
    button.danger { background: #7f1d1d; }
    button.danger:hover { background: #991b1b; }
    button.copy-btn {
      background: #1e293b;
      font-size: 0.78rem;
      padding: 5px 12px;
    }
    button.copy-btn:hover { background: #334155; }

    .msg {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 0.85rem;
      display: none;
    }
    .msg.success { background: #14532d; color: #86efac; display: block; }
    .msg.error   { background: #7f1d1d; color: #fca5a5; display: block; }

    /* Scripts list */
    #script-list { display: flex; flex-direction: column; gap: 10px; }
    .script-item {
      background: #0f0f13;
      border: 1px solid #2a2a3a;
      border-radius: 8px;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .script-info { flex: 1; min-width: 0; }
    .script-name {
      font-weight: 600;
      color: #c4b5fd;
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .script-meta { font-size: 0.75rem; color: #555; margin-top: 2px; }
    .url-box {
      background: #1a1a24;
      border: 1px solid #2a2a3a;
      border-radius: 6px;
      padding: 6px 10px;
      font-family: 'Courier New', monospace;
      font-size: 0.75rem;
      color: #888;
      flex: 2;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .script-actions { display: flex; gap: 8px; }
    .empty { color: #444; text-align: center; padding: 30px; font-size: 0.9rem; }

    .row { display: flex; gap: 14px; }
    .row > * { flex: 1; }
  </style>
</head>
<body>
<div class="container">
  <h1>âš¡ ScriptHost</h1>
  <p class="subtitle">Your personal Lua script cloud</p>

  <!-- Upload Card -->
  <div class="card">
    <h2>Upload Script</h2>
    <div class="row">
      <div>
        <label>Script Name (no spaces)</label>
        <input type="text" id="script-name" placeholder="e.g. myscript or esp_v2" />
      </div>
      <div>
        <label>Upload Password</label>
        <input type="password" id="password" placeholder="Your secret password" />
      </div>
    </div>
    <label>Script Content (Lua)</label>
    <textarea id="script-content" placeholder="-- paste your Lua script here&#10;print('Hello from ScriptHost!')"></textarea>
    <button onclick="uploadScript()">Upload Script</button>
    <div id="upload-msg" class="msg"></div>
  </div>

  <!-- Scripts List Card -->
  <div class="card">
    <h2>Your Scripts</h2>
    <div id="script-list"><div class="empty">Loading...</div></div>
  </div>
</div>

<script>
  const BASE = window.location.origin;

  async function loadScripts() {
    const res = await fetch('/api/scripts');
    const scripts = await res.json();
    const list = document.getElementById('script-list');

    if (scripts.length === 0) {
      list.innerHTML = '<div class="empty">No scripts yet. Upload one above!</div>';
      return;
    }

    list.innerHTML = scripts.map(s => {
      const rawUrl = `${BASE}/raw/${s.name}`;
      const loadstr = `loadstring(game:HttpGet("${rawUrl}"))()`;
      return `
        <div class="script-item">
          <div class="script-info">
            <div class="script-name">ðŸ“œ ${s.name}</div>
            <div class="script-meta">${s.lines} lines Â· ${(s.size/1024).toFixed(1)}KB Â· ${new Date(s.updated).toLocaleDateString()}</div>
          </div>
          <div class="url-box" title="${loadstr}">${loadstr}</div>
          <div class="script-actions">
            <button class="copy-btn" onclick="copyText(\`${loadstr}\`, this)">Copy</button>
            <button class="danger" onclick="deleteScript('${s.name}')">Delete</button>
          </div>
        </div>`;
    }).join('');
  }

  async function uploadScript() {
    const name = document.getElementById('script-name').value.trim();
    const password = document.getElementById('password').value;
    const content = document.getElementById('script-content').value;
    const msg = document.getElementById('upload-msg');

    const res = await fetch('/api/upload', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, password, content })
    });
    const data = await res.json();

    if (data.success) {
      msg.className = 'msg success';
      msg.textContent = `âœ… Uploaded! Use: loadstring(game:HttpGet("${BASE}/raw/${data.name}"))()`;
      document.getElementById('script-name').value = '';
      document.getElementById('script-content').value = '';
      loadScripts();
    } else {
      msg.className = 'msg error';
      msg.textContent = 'âŒ ' + data.error;
    }
  }

  async function deleteScript(name) {
    const password = document.getElementById('password').value;
    if (!password) { alert('Enter your password first!'); return; }
    if (!confirm(`Delete "${name}"?`)) return;

    const res = await fetch(`/api/scripts/${name}`, {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password })
    });
    const data = await res.json();
    if (data.success) loadScripts();
    else alert('Error: ' + data.error);
  }

  function copyText(text, btn) {
    navigator.clipboard.writeText(text);
    const orig = btn.textContent;
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = orig, 1500);
  }

  loadScripts();
</script>
</body>
</html>
